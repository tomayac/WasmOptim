(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();const E="/wasm-clamp/spinner.svg",v=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),A=v?Promise.resolve().then(function(){return _}):Promise.resolve().then(function(){return q});async function T(...e){return(await A).default(...e)}v?Promise.resolve().then(function(){return I}):Promise.resolve().then(function(){return M});v?Promise.resolve().then(function(){return N}):Promise.resolve().then(function(){return R});const x=async e=>{const t=await e.getFile();return t.handle=e,t};var B=async(e=[{}])=>{Array.isArray(e)||(e=[e]);const t=[];e.forEach((i,a)=>{t[a]={description:i.description||"Files",accept:{}},i.mimeTypes?i.mimeTypes.map(s=>{t[a].accept[s]=i.extensions||[]}):t[a].accept["*/*"]=i.extensions||[]});const n=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),r=await Promise.all(n.map(x));return e[0].multiple?r:r[0]},_={__proto__:null,default:B};function h(e){function t(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var r=n.done;return Promise.resolve(n.value).then(function(i){return{value:i,done:r}})}return h=function(n){this.s=n,this.n=n.next},h.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Promise.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Promise.reject(n):t(r.apply(this.s,arguments))}},new h(e)}const L=async(e,t,n=e.name,r)=>{const i=[],a=[];var s,o=!1,c=!1;try{for(var u,d=function(l){var m,f,p,y=2;for(typeof Symbol<"u"&&(f=Symbol.asyncIterator,p=Symbol.iterator);y--;){if(f&&(m=l[f])!=null)return m.call(l);if(p&&(m=l[p])!=null)return new h(m.call(l));f="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());o=!(u=await d.next()).done;o=!1){const l=u.value,m=`${n}/${l.name}`;l.kind==="file"?a.push(l.getFile().then(f=>(f.directoryHandle=e,f.handle=l,Object.defineProperty(f,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>m})))):l.kind!=="directory"||!t||r&&r(l)||i.push(L(l,t,m,r))}}catch(l){c=!0,s=l}finally{try{o&&d.return!=null&&await d.return()}finally{if(c)throw s}}return[...(await Promise.all(i)).flat(),...await Promise.all(a)]};var F=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";const t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await t.values()).next()).done?[t]:L(t,e.recursive,void 0,e.skipDirectory)},I={__proto__:null,default:F},z=async(e,t=[{}],n=null,r=!1,i=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";const a=[];let s=null;if(e instanceof Blob&&e.type?s=e.type:e.headers&&e.headers.get("content-type")&&(s=e.headers.get("content-type")),t.forEach((u,d)=>{a[d]={description:u.description||"Files",accept:{}},u.mimeTypes?(d===0&&s&&u.mimeTypes.push(s),u.mimeTypes.map(l=>{a[d].accept[l]=u.extensions||[]})):s?a[d].accept[s]=u.extensions||[]:a[d].accept["*/*"]=u.extensions||[]}),n)try{await n.getFile()}catch(u){if(n=null,r)throw u}const o=n||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:a,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!n&&i&&i(o);const c=await o.createWritable();return"stream"in e?(await e.stream().pipeTo(c),o):"body"in e?(await e.body.pipeTo(c),o):(await c.write(await e),await c.close(),o)},N={__proto__:null,default:z},O=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((t,n)=>{const r=document.createElement("input");r.type="file";const i=[...e.map(c=>c.mimeTypes||[]),...e.map(c=>c.extensions||[])].join();r.multiple=e[0].multiple||!1,r.accept=i||"",r.style.display="none",document.body.append(r);const a=c=>{typeof s=="function"&&s(),t(c)},s=e[0].legacySetup&&e[0].legacySetup(a,()=>s(n),r),o=()=>{window.removeEventListener("focus",o),r.remove()};r.addEventListener("click",()=>{window.addEventListener("focus",o)}),r.addEventListener("change",()=>{window.removeEventListener("focus",o),r.remove(),a(r.multiple?Array.from(r.files):r.files[0])}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})),q={__proto__:null,default:O},D=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,n)=>{const r=document.createElement("input");r.type="file",r.webkitdirectory=!0;const i=s=>{typeof a=="function"&&a(),t(s)},a=e[0].legacySetup&&e[0].legacySetup(i,()=>a(n),r);r.addEventListener("change",()=>{let s=Array.from(r.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(s=s.filter(o=>o.webkitRelativePath.split("/").every(c=>!e[0].skipDirectory({name:c,kind:"directory"})))):s=s.filter(o=>o.webkitRelativePath.split("/").length===2),i(s)}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})),M={__proto__:null,default:D},U=async(e,t={})=>{Array.isArray(t)&&(t=t[0]);const n=document.createElement("a");let r=e;"body"in e&&(r=await async function(s,o){const c=s.getReader(),u=new ReadableStream({start:m=>async function f(){return c.read().then(({done:p,value:y})=>{if(!p)return m.enqueue(y),f();m.close()})}()}),d=new Response(u),l=await d.blob();return c.releaseLock(),new Blob([l],{type:o})}(e.body,e.headers.get("content-type"))),n.download=t.fileName||"Untitled",n.href=URL.createObjectURL(await r);const i=()=>{typeof a=="function"&&a()},a=t.legacySetup&&t.legacySetup(i,()=>a(),n);return n.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(n.href),3e4),i()}),n.click(),null},R={__proto__:null,default:U};const j=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],C=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],H=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],$=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],b=(e,t,n)=>{let r=e;return typeof t=="string"||Array.isArray(t)?r=e.toLocaleString(t,n):(t===!0||n!==void 0)&&(r=e.toLocaleString(void 0,n)),r};function S(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const n=t.bits?t.binary?$:H:t.binary?C:j,r=t.space?" ":"";if(t.signed&&e===0)return` 0${r}${n[0]}`;const i=e<0,a=i?"-":t.signed?"+":"";i&&(e=-e);let s;if(t.minimumFractionDigits!==void 0&&(s={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(s={maximumFractionDigits:t.maximumFractionDigits,...s}),e<1){const d=b(e,t.locale,s);return a+d+r+n[0]}const o=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),n.length-1);e/=(t.binary?1024:1e3)**o,s||(e=e.toPrecision(3));const c=b(Number(e),t.locale,s),u=n[o];return a+c+r+u}const Y=document.querySelector("#load-wasm");document.querySelector("#before-size");document.querySelector("#after-size");document.querySelector("#delta-size");const w=document.querySelector("#drop-area"),W=document.querySelector("#results-area"),G=document.querySelector("#stats-template"),Z=document.querySelector("#stats-header"),K=document.querySelector("#overwrite-checkbox");async function J(e,t){const n=[];async function r(a){for(const[s,o]of a)try{n[s]=await o()}catch(c){n[s]=new Error(`Failed with: ${c.message}`)}}const i=new Array(t).fill(e.entries()).map(r);return await Promise.allSettled(i),n}const P="getAsFileSystemHandle"in DataTransferItem.prototype;Y.addEventListener("click",async()=>{try{const e=await T({mimeTypes:["application/wasm"],extensions:[".wasm"],multiple:!0});if(!e||!e.length)return;k(e)}catch(e){if(e.name==="AbortError")return;console.error(e.name,e.message)}});w.addEventListener("dragover",e=>{e.preventDefault()});w.addEventListener("dragenter",e=>{w.classList.add("drag-hover")});w.addEventListener("dragleave",e=>{w.classList.remove("drag-hover")});w.addEventListener("drop",async e=>{e.preventDefault(),w.classList.remove("drag-hover");const t=[...e.dataTransfer.items].filter(r=>r.kind==="file").map(r=>P?r.getAsFileSystemHandle():r.getAsFile()),n=[];for await(const r of t){let i=r;r.kind==="file"&&(i=await r.getFile()),i.type==="application/wasm"&&(i.handle=r,n.push(i))}k(n)});const k=async e=>{Z.hidden=!1;const t=[];for(const n of e){const r=G.content.cloneNode(!0),i=r.querySelector(".file-name"),a=r.querySelector(".before-size"),s=r.querySelector(".after-size"),o=r.querySelector(".delta-size"),c=r.querySelector(".spinner");c.src=E,i.textContent=n.name,a.textContent=S(n.size),W.append(r),t.push(()=>new Promise((u,d)=>{const l=new Worker(new URL("/wasm-clamp/assets/worker-852eb24e.js",self.location),{type:"module"});l.addEventListener("message",async m=>{l.terminate();const{wasmFileAfter:f,error:p}=m.data;if(p){d(p),s.classList.add("error"),o.classList.add("error"),s.textContent=p.name,o.textContent=p.message;return}s.textContent=S(f.size);const y=f.size-n.size;o.textContent=`${(100-f.size/n.size*100).toFixed(2)}%`,y<0?o.classList.add("size-smaller"):y>=0&&o.classList.add("size-larger"),y<0&&P&&v&&K.checked&&await n.handle.createWritable().then(g=>{g.write(f),g.close()}),u()}),l.postMessage({wasmFileBefore:n})}))}await J(t,"hardwareConcurrency"in navigator?Math.floor(navigator.hardwareConcurrency/2):4)};
