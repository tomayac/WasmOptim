(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();const H="modulepreload",Z=function(e){return"/wasm-clamp/"+e},x={},h=function(t,r,n){if(!r||r.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=Z(s),s in x)return;x[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!n)for(let u=i.length-1;u>=0;u--){const d=i[u];if(d.href===s&&(!a||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":H,a||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),a)return new Promise((u,d)=>{l.addEventListener("load",u),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};const b=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),V=b?Promise.resolve().then(function(){return te}):Promise.resolve().then(function(){return oe});async function G(...e){return(await V).default(...e)}const Y=b?Promise.resolve().then(function(){return ne}):Promise.resolve().then(function(){return le});async function K(...e){return(await Y).default(...e)}const X=b?Promise.resolve().then(function(){return ie}):Promise.resolve().then(function(){return ue});async function Q(...e){return(await X).default(...e)}const J=async e=>{const t=await e.getFile();return t.handle=e,t};var ee=async(e=[{}])=>{Array.isArray(e)||(e=[e]);const t=[];e.forEach((i,s)=>{t[s]={description:i.description||"Files",accept:{}},i.mimeTypes?i.mimeTypes.map(a=>{t[s].accept[a]=i.extensions||[]}):t[s].accept["*/*"]=i.extensions||[]});const r=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),n=await Promise.all(r.map(J));return e[0].multiple?n:n[0]},te={__proto__:null,default:ee};function k(e){function t(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var n=r.done;return Promise.resolve(r.value).then(function(i){return{value:i,done:n}})}return k=function(r){this.s=r,this.n=r.next},k.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?Promise.resolve({value:r,done:!0}):t(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?Promise.reject(r):t(n.apply(this.s,arguments))}},new k(e)}const I=async(e,t,r=e.name,n)=>{const i=[],s=[];var a,o=!1,c=!1;try{for(var l,u=function(d){var f,m,p,y=2;for(typeof Symbol<"u"&&(m=Symbol.asyncIterator,p=Symbol.iterator);y--;){if(m&&(f=d[m])!=null)return f.call(d);if(p&&(f=d[p])!=null)return new k(f.call(d));m="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());o=!(l=await u.next()).done;o=!1){const d=l.value,f=`${r}/${d.name}`;d.kind==="file"?s.push(d.getFile().then(m=>(m.directoryHandle=e,m.handle=d,Object.defineProperty(m,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>f})))):d.kind!=="directory"||!t||n&&n(d)||i.push(I(d,t,f,n))}}catch(d){c=!0,a=d}finally{try{o&&u.return!=null&&await u.return()}finally{if(c)throw a}}return[...(await Promise.all(i)).flat(),...await Promise.all(s)]};var re=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";const t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await t.values()).next()).done?[t]:I(t,e.recursive,void 0,e.skipDirectory)},ne={__proto__:null,default:re},ae=async(e,t=[{}],r=null,n=!1,i=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";const s=[];let a=null;if(e instanceof Blob&&e.type?a=e.type:e.headers&&e.headers.get("content-type")&&(a=e.headers.get("content-type")),t.forEach((l,u)=>{s[u]={description:l.description||"Files",accept:{}},l.mimeTypes?(u===0&&a&&l.mimeTypes.push(a),l.mimeTypes.map(d=>{s[u].accept[d]=l.extensions||[]})):a?s[u].accept[a]=l.extensions||[]:s[u].accept["*/*"]=l.extensions||[]}),r)try{await r.getFile()}catch(l){if(r=null,n)throw l}const o=r||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:s,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!r&&i&&i(o);const c=await o.createWritable();return"stream"in e?(await e.stream().pipeTo(c),o):"body"in e?(await e.body.pipeTo(c),o):(await c.write(await e),await c.close(),o)},ie={__proto__:null,default:ae},se=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((t,r)=>{const n=document.createElement("input");n.type="file";const i=[...e.map(c=>c.mimeTypes||[]),...e.map(c=>c.extensions||[])].join();n.multiple=e[0].multiple||!1,n.accept=i||"",n.style.display="none",document.body.append(n);const s=c=>{typeof a=="function"&&a(),t(c)},a=e[0].legacySetup&&e[0].legacySetup(s,()=>a(r),n),o=()=>{window.removeEventListener("focus",o),n.remove()};n.addEventListener("click",()=>{window.addEventListener("focus",o)}),n.addEventListener("change",()=>{window.removeEventListener("focus",o),n.remove(),s(n.multiple?Array.from(n.files):n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),oe={__proto__:null,default:se},ce=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,r)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const i=a=>{typeof s=="function"&&s(),t(a)},s=e[0].legacySetup&&e[0].legacySetup(i,()=>s(r),n);n.addEventListener("change",()=>{let a=Array.from(n.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(a=a.filter(o=>o.webkitRelativePath.split("/").every(c=>!e[0].skipDirectory({name:c,kind:"directory"})))):a=a.filter(o=>o.webkitRelativePath.split("/").length===2),i(a)}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),le={__proto__:null,default:ce},de=async(e,t={})=>{Array.isArray(t)&&(t=t[0]);const r=document.createElement("a");let n=e;"body"in e&&(n=await async function(a,o){const c=a.getReader(),l=new ReadableStream({start:f=>async function m(){return c.read().then(({done:p,value:y})=>{if(!p)return f.enqueue(y),m();f.close()})}()}),u=new Response(l),d=await u.blob();return c.releaseLock(),new Blob([d],{type:o})}(e.body,e.headers.get("content-type"))),r.download=t.fileName||"Untitled",r.href=URL.createObjectURL(await n);const i=()=>{typeof s=="function"&&s()},s=t.legacySetup&&t.legacySetup(i,()=>s(),r);return r.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(r.href),3e4),i()}),r.click(),null},ue={__proto__:null,default:de};const D="/wasm-clamp/spinner.svg",me=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],fe=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],pe=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],ye=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],B=(e,t,r)=>{let n=e;return typeof t=="string"||Array.isArray(t)?n=e.toLocaleString(t,r):(t===!0||r!==void 0)&&(n=e.toLocaleString(void 0,r)),n};function O(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const r=t.bits?t.binary?ye:pe:t.binary?fe:me,n=t.space?" ":"";if(t.signed&&e===0)return` 0${n}${r[0]}`;const i=e<0,s=i?"-":t.signed?"+":"";i&&(e=-e);let a;if(t.minimumFractionDigits!==void 0&&(a={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(a={maximumFractionDigits:t.maximumFractionDigits,...a}),e<1){const u=B(e,t.locale,a);return s+u+n+r[0]}const o=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),r.length-1);e/=(t.binary?1024:1e3)**o,a||(e=e.toPrecision(3));const c=B(Number(e),t.locale,a),l=r[o];return s+c+n+l}const he=document.querySelector("#load-wasm"),we=document.querySelector("#load-directory");document.querySelector("#before-size");document.querySelector("#after-size");document.querySelector("#delta-size");const _=document.querySelector("#drop-area"),L=document.querySelector("#results-area"),ge=document.querySelector("#stats-template"),ve=document.querySelector("#example-template"),be=document.querySelector("#stats-header"),R=document.querySelector("#overwrite-checkbox"),v=document.querySelector("#observe-changes-checkbox"),z=document.querySelector("#examples-list"),N=async(e,t)=>{const r=[];async function n(s){for(const[a,o]of s)try{r[a]=await o()}catch(c){r[a]=new Error(`Failed with: ${c.message}`)}}const i=new Array(t).fill(e.entries()).map(n);return await Promise.allSettled(i),r},C=(e,t)=>{let r;return function(...i){const s=()=>{clearTimeout(r),e(...i)};clearTimeout(r),r=setTimeout(s,t)}},_e=async e=>{const t=[];async function r(i){const s=await new Promise(a=>i.readEntries(a));await Promise.all(s.map(async a=>{a.isDirectory?await r(a.createReader()):t.push(a)}))}const n=e.createReader();return await r(n),t},U=async(e,t,r=e.name,n)=>{const i=[],s=[];for await(const a of e.values()){const o=`${r}/${a.name}`;a.kind==="file"?s.push(a.getFile().then(c=>(c.directoryHandle=e,c.handle=a,Object.defineProperty(c,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>o})))):a.kind==="directory"&&t&&i.push(U(a,t,o))}return[...(await Promise.all(i)).flat(),...await Promise.all(s)]},q=Object.freeze(Object.defineProperty({__proto__:null,debounce:C,limit:N,readDirectory:U,readDirectoryLegacy:_e},Symbol.toStringTag,{value:"Module"}));let g=null;const E="getUniqueId"in FileSystemHandle.prototype,Se=async e=>{const t=[];for(const r of e)if(r.type==="modified"){const n=await r.changedHandle.getFile();console.log(`${n.name} modified → Re-optimizing`),n.handle=r.changedHandle;const i=E?await r.changedHandle.getUniqueId():r.changedHandle.name;t.push(n);for(const[s,{handle:a}]of P.entries())(E?await a.getUniqueId():a.name)===i&&document.querySelector(`[data-uuid="${s}"]`)?.closest("tr")?.remove()}S(t)},M=()=>(g||(g=new FileSystemObserver(C(e=>{Se(e)},250))),g);v.parentNode.hidden=!1;v.addEventListener("change",()=>{if(localStorage.setItem("observe-changes",v.checked),v.checked){M();for(const[,{handle:e,file:t}]of P.entries())e&&g.observe(e);return}g&&(g.disconnect(),g=null)});localStorage.getItem("observe-changes")!=="true"?v.checked=!1:v.checked=!0;const $=Object.freeze(Object.defineProperty({__proto__:null,getFileSystemChangeObserver:M,supportsGetUniqueId:E},Symbol.toStringTag,{value:"Module"})),P=new Map,S=async e=>{be.hidden=!1,L.closest("table").hidden=!1;const t=[];for(const r of e){const n=ge.content.cloneNode(!0),i=n.querySelector(".file-name"),s=n.querySelector(".before-size"),a=n.querySelector(".after-size"),o=n.querySelector(".delta-size"),c=n.querySelector(".spinner");c.src=D,i.querySelector("code").textContent=r.name,i.classList.add("processing"),s.textContent=O(r.size),L.append(n),t.push(()=>new Promise((l,u)=>{const d=new Worker(new URL("/wasm-clamp/assets/binaryen-worker-4ccba523.js",self.location));d.addEventListener("message",async f=>{d.terminate(),i.classList.remove("processing");const{wasmFileAfter:m,error:p}=f.data;if(p){u(p),i.classList.add("error"),a.classList.add("error"),o.classList.add("error"),a.textContent=p.name,o.textContent=p.message;return}a.textContent=O(m.size);const y=m.size-r.size;console.log(`${r.name} processed → Before: ${r.size} After: ${m.size} Delta: ${y}`);const T=Math.abs(100-m.size/r.size*100).toFixed(2);o.textContent=Number(T)===0?"no change":`${T}% ${y<0?"smaller":"larger"}`,o.classList.add(y<0?"size-smaller":"size-larger");const F=E&&r.handle?await r.handle.getUniqueId():r.name;if(i.dataset.uuid=F,P.set(F,{file:m,handle:r.handle}),y<0&&A&&b&&R.checked&&r.handle)try{const w=await r.handle.createWritable();await w.write(m),await w.close()}catch(w){console.error(w.name,w.message)}if(W&&v.checked&&r.handle){const{getFileSystemChangeObserver:w}=await h(()=>Promise.resolve().then(()=>$),void 0);w().observe(r.handle),console.log(`${r.name} → Observing changes`)}l()}),d.postMessage({wasmFileBefore:r})}))}await N(t,"hardwareConcurrency"in navigator?Math.floor(navigator.hardwareConcurrency/2):4)},ke=async e=>{for(const t of e)await t.handle.requestPermission({mode:"readwrite"})},Ee=["https://unpkg.com/canvaskit-wasm@0.39.1/bin/canvaskit.wasm","https://unpkg.com/zxing-wasm@1.0.0-rc.4/dist/full/zxing_full.wasm","https://unpkg.com/@sqlite.org/sqlite-wasm@3.44.0-build1/sqlite-wasm/jswasm/sqlite3.wasm","https://unpkg.com/@tensorflow/tfjs-backend-wasm@4.13.0/wasm-out/tfjs-backend-wasm.wasm"],Pe=/@(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?/;Ee.forEach(e=>{const t=ve.content.cloneNode(!0),r=t.querySelector("code"),n=t.querySelector("a");r.textContent=e.replace("https://unpkg.com/","").replace(Pe,""),n.href=e,z.append(t)});z.addEventListener("click",async e=>{if(e.target.nodeName.toLowerCase()!=="code")return;e.preventDefault();const t=e.target.closest("a"),r=t.href,n=t.parentNode.querySelector(".downloading");n.hidden=!1;const i=t.parentNode.querySelector("img");i.src=D;const s=await fetch(r).then(o=>o.blob());i.removeAttribute("src"),n.hidden=!0;const a=new File([s],r.split("/").pop(),{type:"application/wasm"});a.handle=!1,S([a])});document.addEventListener("paste",e=>{try{if(!e.clipboardData.files.length)return;const t=Array.from(e.clipboardData.files).filter(r=>r.type==="application/wasm"||r.name.endsWith(".wasm"));S(t)}catch(t){console.error(t.name,t.message)}});L.addEventListener("click",async e=>{if(e.preventDefault(),e.target.nodeName.toLowerCase()!=="code")return;const t=e.target.closest("a");if(!t.classList.contains("file-name")||t.classList.contains("error")||t.classList.contains("processing"))return;const r=t.dataset.uuid,{file:n}=P.get(r);try{await Q(n,{fileName:n.name,extensions:[".wasm"],mimeTypes:["application/wasm"]})}catch(i){if(i.name==="AbortError")return;console.error(i.name,i.message)}});we.addEventListener("click",async()=>{try{const t=(await K({recursive:!0,mode:"readwrite"})).filter(r=>r.type==="application/wasm"||r.name.endsWith(".wasm"));S(t)}catch(e){if(e.name==="AbortError")return;console.error(e.name,e.message)}});he.addEventListener("click",async()=>{try{const e=await G({mimeTypes:["application/wasm"],extensions:[".wasm"],multiple:!0});if(!e||!e.length)return;S(e)}catch(e){if(e.name==="AbortError")return;console.error(e.name,e.message)}});_.addEventListener("dragover",e=>{e.preventDefault()});_.addEventListener("dragenter",e=>{_.classList.add("drag-hover")});_.addEventListener("dragleave",e=>{_.classList.remove("drag-hover")});_.addEventListener("drop",async e=>{e.preventDefault(),_.classList.remove("drag-hover");const t=[...e.dataTransfer.items].filter(n=>n.kind==="file").map(n=>A?n.getAsFileSystemHandle():n.webkitGetAsEntry()),r=[];for await(const n of t){if(n.kind==="directory"){const{readDirectory:s}=await h(()=>Promise.resolve().then(()=>q),void 0);let a=await s(n,!0);a=a.filter(o=>o.type==="application/wasm"||o.name.endsWith(".wasm")),r.push(...a);continue}else if(n.isDirectory){const{readDirectoryLegacy:s}=await h(()=>Promise.resolve().then(()=>q),void 0);let a=await s(n);a=a.filter(o=>o.name.endsWith(".wasm")),r.push(...await Promise.all(a.map(async o=>new Promise(c=>o.file(c)))));continue}let i;n.kind==="file"?(i=await n.getFile(),i.handle=n):n.isFile&&(i=await new Promise(s=>n.file(a=>s(a)))),!(i.type&&i.type!=="application/wasm"||!i.name.endsWith(".wasm"))&&r.push(i)}b&&b&&R.checked&&await ke(r),S(r)});const j=e=>{const t=document.querySelector("meta[name=theme-color]");if(e.matches){t.content="Canvas";return}};matchMedia("(prefers-color-scheme: dark)").addEventListener("change",j);j(matchMedia("(prefers-color-scheme: dark)"));const A="getAsFileSystemHandle"in DataTransferItem.prototype,W="FileSystemObserver"in window;(async()=>{if(W&&h(()=>Promise.resolve().then(()=>$),void 0),A&&b&&h(()=>import("./file-handle-drag-and-drop-fa3faa98.js"),[]),"launchQueue"in window&&"files"in LaunchParams.prototype&&h(()=>import("./file-handling-46f15c87.js"),[]),"serviceWorker"in navigator){const{registerSW:e}=await h(()=>import("./virtual_pwa-register-e6b26fcc.js"),[]);e({onOfflineReady(){},onNeedRefresh(){location.reload()}})(),h(()=>import("./web-share-target-2a6a0db6.js"),[])}})();export{h as _,S as a,ke as c,b as e,R as o};
