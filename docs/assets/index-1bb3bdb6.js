(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const N="modulepreload",I=function(e){return"/wasm-clamp/"+e},P={},R=function(t,n,r){if(!n||n.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=I(s),s in P)return;P[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const c=i[u];if(c.href===s&&(!a||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const l=document.createElement("link");if(l.rel=a?"stylesheet":N,a||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),a)return new Promise((u,c)=>{l.addEventListener("load",u),l.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};function D(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:a}=e;let o,d;const l=async(c=!0)=>{await d};async function u(){if("serviceWorker"in navigator){const{Workbox:c}=await R(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);o=new c("/wasm-clamp/sw.js",{scope:"/wasm-clamp/",type:"classic"}),o.addEventListener("activated",f=>{(f.isUpdate||f.isExternal)&&window.location.reload()}),o.addEventListener("installed",f=>{f.isUpdate||r?.()}),o.register({immediate:t}).then(f=>{s?s("/wasm-clamp/sw.js",f):i?.(f)}).catch(f=>{a?.(f)})}}return d=u(),l}const _="/wasm-clamp/spinner.svg",w=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),O=w?Promise.resolve().then(function(){return M}):Promise.resolve().then(function(){return K});async function z(...e){return(await O).default(...e)}w?Promise.resolve().then(function(){return H}):Promise.resolve().then(function(){return V});const U=w?Promise.resolve().then(function(){return G}):Promise.resolve().then(function(){return J});async function W(...e){return(await U).default(...e)}const C=async e=>{const t=await e.getFile();return t.handle=e,t};var j=async(e=[{}])=>{Array.isArray(e)||(e=[e]);const t=[];e.forEach((i,s)=>{t[s]={description:i.description||"Files",accept:{}},i.mimeTypes?i.mimeTypes.map(a=>{t[s].accept[a]=i.extensions||[]}):t[s].accept["*/*"]=i.extensions||[]});const n=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),r=await Promise.all(n.map(C));return e[0].multiple?r:r[0]},M={__proto__:null,default:j};function b(e){function t(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var r=n.done;return Promise.resolve(n.value).then(function(i){return{value:i,done:r}})}return b=function(n){this.s=n,this.n=n.next},b.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Promise.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Promise.reject(n):t(r.apply(this.s,arguments))}},new b(e)}const A=async(e,t,n=e.name,r)=>{const i=[],s=[];var a,o=!1,d=!1;try{for(var l,u=function(c){var f,m,p,y=2;for(typeof Symbol<"u"&&(m=Symbol.asyncIterator,p=Symbol.iterator);y--;){if(m&&(f=c[m])!=null)return f.call(c);if(p&&(f=c[p])!=null)return new b(f.call(c));m="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());o=!(l=await u.next()).done;o=!1){const c=l.value,f=`${n}/${c.name}`;c.kind==="file"?s.push(c.getFile().then(m=>(m.directoryHandle=e,m.handle=c,Object.defineProperty(m,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>f})))):c.kind!=="directory"||!t||r&&r(c)||i.push(A(c,t,f,r))}}catch(c){d=!0,a=c}finally{try{o&&u.return!=null&&await u.return()}finally{if(d)throw a}}return[...(await Promise.all(i)).flat(),...await Promise.all(s)]};var $=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";const t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await t.values()).next()).done?[t]:A(t,e.recursive,void 0,e.skipDirectory)},H={__proto__:null,default:$},Y=async(e,t=[{}],n=null,r=!1,i=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";const s=[];let a=null;if(e instanceof Blob&&e.type?a=e.type:e.headers&&e.headers.get("content-type")&&(a=e.headers.get("content-type")),t.forEach((l,u)=>{s[u]={description:l.description||"Files",accept:{}},l.mimeTypes?(u===0&&a&&l.mimeTypes.push(a),l.mimeTypes.map(c=>{s[u].accept[c]=l.extensions||[]})):a?s[u].accept[a]=l.extensions||[]:s[u].accept["*/*"]=l.extensions||[]}),n)try{await n.getFile()}catch(l){if(n=null,r)throw l}const o=n||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:s,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!n&&i&&i(o);const d=await o.createWritable();return"stream"in e?(await e.stream().pipeTo(d),o):"body"in e?(await e.body.pipeTo(d),o):(await d.write(await e),await d.close(),o)},G={__proto__:null,default:Y},Z=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((t,n)=>{const r=document.createElement("input");r.type="file";const i=[...e.map(d=>d.mimeTypes||[]),...e.map(d=>d.extensions||[])].join();r.multiple=e[0].multiple||!1,r.accept=i||"",r.style.display="none",document.body.append(r);const s=d=>{typeof a=="function"&&a(),t(d)},a=e[0].legacySetup&&e[0].legacySetup(s,()=>a(n),r),o=()=>{window.removeEventListener("focus",o),r.remove()};r.addEventListener("click",()=>{window.addEventListener("focus",o)}),r.addEventListener("change",()=>{window.removeEventListener("focus",o),r.remove(),s(r.multiple?Array.from(r.files):r.files[0])}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})),K={__proto__:null,default:Z},Q=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,n)=>{const r=document.createElement("input");r.type="file",r.webkitdirectory=!0;const i=a=>{typeof s=="function"&&s(),t(a)},s=e[0].legacySetup&&e[0].legacySetup(i,()=>s(n),r);r.addEventListener("change",()=>{let a=Array.from(r.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(a=a.filter(o=>o.webkitRelativePath.split("/").every(d=>!e[0].skipDirectory({name:d,kind:"directory"})))):a=a.filter(o=>o.webkitRelativePath.split("/").length===2),i(a)}),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})),V={__proto__:null,default:Q},X=async(e,t={})=>{Array.isArray(t)&&(t=t[0]);const n=document.createElement("a");let r=e;"body"in e&&(r=await async function(a,o){const d=a.getReader(),l=new ReadableStream({start:f=>async function m(){return d.read().then(({done:p,value:y})=>{if(!p)return f.enqueue(y),m();f.close()})}()}),u=new Response(l),c=await u.blob();return d.releaseLock(),new Blob([c],{type:o})}(e.body,e.headers.get("content-type"))),n.download=t.fileName||"Untitled",n.href=URL.createObjectURL(await r);const i=()=>{typeof s=="function"&&s()},s=t.legacySetup&&t.legacySetup(i,()=>s(),n);return n.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(n.href),3e4),i()}),n.click(),null},J={__proto__:null,default:X};const ee=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],te=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],re=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],ne=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],B=(e,t,n)=>{let r=e;return typeof t=="string"||Array.isArray(t)?r=e.toLocaleString(t,n):(t===!0||n!==void 0)&&(r=e.toLocaleString(void 0,n)),r};function x(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const n=t.bits?t.binary?ne:re:t.binary?te:ee,r=t.space?" ":"";if(t.signed&&e===0)return` 0${r}${n[0]}`;const i=e<0,s=i?"-":t.signed?"+":"";i&&(e=-e);let a;if(t.minimumFractionDigits!==void 0&&(a={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(a={maximumFractionDigits:t.maximumFractionDigits,...a}),e<1){const u=B(e,t.locale,a);return s+u+r+n[0]}const o=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),n.length-1);e/=(t.binary?1024:1e3)**o,a||(e=e.toPrecision(3));const d=B(Number(e),t.locale,a),l=n[o];return s+d+r+l}const ie=document.querySelector("#load-wasm");document.querySelector("#before-size");document.querySelector("#after-size");document.querySelector("#delta-size");const g=document.querySelector("#drop-area"),k=document.querySelector("#results-area"),se=document.querySelector("#stats-template"),ae=document.querySelector("#example-template"),oe=document.querySelector("#stats-header"),h=document.querySelector("#overwrite-checkbox"),F=document.querySelector("#examples-list");async function ce(e,t){const n=[];async function r(s){for(const[a,o]of s)try{n[a]=await o()}catch(d){n[a]=new Error(`Failed with: ${d.message}`)}}const i=new Array(t).fill(e.entries()).map(r);return await Promise.allSettled(i),n}const le=["https://unpkg.com/@mediapipe/tasks-vision@0.10.7/wasm/vision_wasm_internal.wasm","https://unpkg.com/@sqlite.org/sqlite-wasm@3.44.0-build1/sqlite-wasm/jswasm/sqlite3.wasm","https://unpkg.com/@tensorflow/tfjs-backend-wasm@4.13.0/wasm-out/tfjs-backend-wasm.wasm"],S="getAsFileSystemHandle"in DataTransferItem.prototype,T=new Map;S&&w&&(h.parentNode.hidden=!1,h.addEventListener("change",()=>{localStorage.setItem("overwrite",h.checked)}),localStorage.getItem("overwrite")!=="true"?h.checked=!1:h.checked=!0),le.forEach(t=>{const n=ae.content.cloneNode(!0),r=n.querySelector("code"),i=n.querySelector("a");r.textContent=t.replace("https://unpkg.com/","").replace(/@\d+(\.\d+)*/g,""),i.href=t,F.append(n)}),"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{await navigator.serviceWorker.register("./sharetargetsw.js",{scope:"./share-target/"})}catch(t){console.error(t.name,t.message)}if(location.search.includes("share-target")){const t=await caches.keys(),r=await(await caches.open(t.filter(i=>i.startsWith("media"))[0])).match("shared-wasm-files");console.log("main",r),r&&(r.handle=!1,v([r]))}}),D({onOfflineReady(){},onNeedRefresh(){location.reload()}})();document.addEventListener("paste",e=>{try{if(!e.clipboardData.files.length)return;const t=Array.from(e.clipboardData.files).filter(n=>n.type==="application/wasm"||n.name.endsWith(".wasm"));v(t)}catch(t){console.error(t.name,t.message)}});F.addEventListener("click",async e=>{if(e.target.nodeName.toLowerCase()!=="code")return;e.preventDefault();const t=e.target.closest("a"),n=t.href,r=t.parentNode.querySelector(".downloading");r.hidden=!1;const i=t.parentNode.querySelector("img");i.src=_;const s=await fetch(n).then(o=>o.blob());i.src="",r.hidden=!0;const a=new File([s],n.split("/").pop(),{type:"application/wasm"});a.handle=!1,v([a])});k.addEventListener("click",async e=>{if(e.target.nodeName.toLowerCase()!=="code")return;const t=e.target.closest("a");if(!t.classList.contains("file-name")||t.dataset.processing)return;e.preventDefault();const n=t.dataset.uuid,r=T.get(n);try{await W(r,{fileName:r.name,extensions:[".wasm"],mimeTypes:["application/wasm"]})}catch(i){if(i.name==="AbortError")return;console.error(i.name,i.message)}});ie.addEventListener("click",async()=>{try{const e=await z({mimeTypes:["application/wasm"],extensions:[".wasm"],multiple:!0});if(!e||!e.length)return;v(e)}catch(e){if(e.name==="AbortError")return;console.error(e.name,e.message)}});g.addEventListener("dragover",e=>{e.preventDefault()});g.addEventListener("dragenter",e=>{g.classList.add("drag-hover")});g.addEventListener("dragleave",e=>{g.classList.remove("drag-hover")});g.addEventListener("drop",async e=>{e.preventDefault(),g.classList.remove("drag-hover");const t=[...e.dataTransfer.items].filter(r=>r.kind==="file").map(r=>S?r.getAsFileSystemHandle():r.getAsFile()),n=[];for await(const r of t){let i=r;r.kind==="file"&&(i=await r.getFile(),i.handle=r),!(i.type&&i.type!=="application/wasm"||!i.name.endsWith(".wasm"))&&n.push(i)}w&&w&&h.checked&&await q(n),v(n)});"launchQueue"in window&&"files"in LaunchParams.prototype&&launchQueue.setConsumer(async e=>{if(!e.files.length)return;const t=[];for(const n of e.files){const r=await n.getFile();r.handle=n,!(r.type&&r.type!=="application/wasm"||!r.name.endsWith(".wasm"))&&t.push(r)}w&&w&&h.checked&&await q(t),v(t)});const q=async e=>{for(const t of e)await t.handle.requestPermission({mode:"readwrite"})},v=async e=>{oe.hidden=!1,k.closest("table").hidden=!1;const t=[];for(const n of e){const r=se.content.cloneNode(!0),i=r.querySelector(".file-name"),s=r.querySelector(".before-size"),a=r.querySelector(".after-size"),o=r.querySelector(".delta-size"),d=r.querySelector(".spinner");d.src=_,i.querySelector("code").textContent=n.name,i.dataset.processing=!0,s.textContent=x(n.size),k.append(r),t.push(()=>new Promise((l,u)=>{const c=new Worker(new URL("/wasm-clamp/assets/worker-852eb24e.js",self.location));c.addEventListener("message",async f=>{c.terminate();const{wasmFileAfter:m,error:p}=f.data;if(p){u(p),i.classList.add("error"),a.classList.add("error"),o.classList.add("error"),a.textContent=p.name,o.textContent=p.message;return}a.textContent=x(m.size);const y=m.size-n.size;if(console.log(n.name,"→","Before:",n.size,"After:",m.size,"Delta:",y),o.textContent=`${Math.abs(100-m.size/n.size*100).toFixed(2)}% ${y<0?"smaller":"larger"}`,y<0?o.classList.add("size-smaller"):y>=0&&o.classList.add("size-larger"),y<0){const L=crypto.randomUUID();i.dataset.uuid=L,delete i.dataset.processing,T.set(L,m),S&&w&&h.checked&&n.handle&&await n.handle.createWritable().then(E=>{E.write(m),E.close()})}l()}),c.postMessage({wasmFileBefore:n})}))}await ce(t,"hardwareConcurrency"in navigator?Math.floor(navigator.hardwareConcurrency/2):4)};
