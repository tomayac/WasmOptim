(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();const O="modulepreload",R=function(e){return"/wasm-clamp/"+e},F={},C=function(t,r,n){if(!r||r.length===0)return t();const a=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=R(s),s in F)return;F[s]=!0;const i=s.endsWith(".css"),o=i?'[rel="stylesheet"]':"";if(!!n)for(let u=a.length-1;u>=0;u--){const d=a[u];if(d.href===s&&(!i||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const l=document.createElement("link");if(l.rel=i?"stylesheet":O,i||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),i)return new Promise((u,d)=>{l.addEventListener("load",u),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s})};function D(e={}){const{immediate:t=!1,onNeedRefresh:r,onOfflineReady:n,onRegistered:a,onRegisteredSW:s,onRegisterError:i}=e;let o,c;const l=async(d=!0)=>{await c};async function u(){if("serviceWorker"in navigator){const{Workbox:d}=await C(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]);o=new d("/wasm-clamp/sw.js",{scope:"/wasm-clamp/",type:"classic"}),o.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),o.addEventListener("installed",m=>{m.isUpdate||n?.()}),o.register({immediate:t}).then(m=>{s?s("/wasm-clamp/sw.js",m):a?.(m)}).catch(m=>{i?.(m)})}}return c=u(),l}const T="/wasm-clamp/spinner.svg",y=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),U=y?Promise.resolve().then(function(){return G}):Promise.resolve().then(function(){return ee});async function W(...e){return(await U).default(...e)}const M=y?Promise.resolve().then(function(){return Q}):Promise.resolve().then(function(){return re});async function j(...e){return(await M).default(...e)}const $=y?Promise.resolve().then(function(){return X}):Promise.resolve().then(function(){return ae});async function Z(...e){return(await $).default(...e)}const H=async e=>{const t=await e.getFile();return t.handle=e,t};var Y=async(e=[{}])=>{Array.isArray(e)||(e=[e]);const t=[];e.forEach((a,s)=>{t[s]={description:a.description||"Files",accept:{}},a.mimeTypes?a.mimeTypes.map(i=>{t[s].accept[i]=a.extensions||[]}):t[s].accept["*/*"]=a.extensions||[]});const r=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),n=await Promise.all(r.map(H));return e[0].multiple?n:n[0]},G={__proto__:null,default:Y};function S(e){function t(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var n=r.done;return Promise.resolve(r.value).then(function(a){return{value:a,done:n}})}return S=function(r){this.s=r,this.n=r.next},S.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?Promise.resolve({value:r,done:!0}):t(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?Promise.reject(r):t(n.apply(this.s,arguments))}},new S(e)}const q=async(e,t,r=e.name,n)=>{const a=[],s=[];var i,o=!1,c=!1;try{for(var l,u=function(d){var m,f,p,h=2;for(typeof Symbol<"u"&&(f=Symbol.asyncIterator,p=Symbol.iterator);h--;){if(f&&(m=d[f])!=null)return m.call(d);if(p&&(m=d[p])!=null)return new S(m.call(d));f="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());o=!(l=await u.next()).done;o=!1){const d=l.value,m=`${r}/${d.name}`;d.kind==="file"?s.push(d.getFile().then(f=>(f.directoryHandle=e,f.handle=d,Object.defineProperty(f,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>m})))):d.kind!=="directory"||!t||n&&n(d)||a.push(q(d,t,m,n))}}catch(d){c=!0,i=d}finally{try{o&&u.return!=null&&await u.return()}finally{if(c)throw i}}return[...(await Promise.all(a)).flat(),...await Promise.all(s)]};var K=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";const t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await t.values()).next()).done?[t]:q(t,e.recursive,void 0,e.skipDirectory)},Q={__proto__:null,default:K},V=async(e,t=[{}],r=null,n=!1,a=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";const s=[];let i=null;if(e instanceof Blob&&e.type?i=e.type:e.headers&&e.headers.get("content-type")&&(i=e.headers.get("content-type")),t.forEach((l,u)=>{s[u]={description:l.description||"Files",accept:{}},l.mimeTypes?(u===0&&i&&l.mimeTypes.push(i),l.mimeTypes.map(d=>{s[u].accept[d]=l.extensions||[]})):i?s[u].accept[i]=l.extensions||[]:s[u].accept["*/*"]=l.extensions||[]}),r)try{await r.getFile()}catch(l){if(r=null,n)throw l}const o=r||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:s,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!r&&a&&a(o);const c=await o.createWritable();return"stream"in e?(await e.stream().pipeTo(c),o):"body"in e?(await e.body.pipeTo(c),o):(await c.write(await e),await c.close(),o)},X={__proto__:null,default:V},J=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((t,r)=>{const n=document.createElement("input");n.type="file";const a=[...e.map(c=>c.mimeTypes||[]),...e.map(c=>c.extensions||[])].join();n.multiple=e[0].multiple||!1,n.accept=a||"",n.style.display="none",document.body.append(n);const s=c=>{typeof i=="function"&&i(),t(c)},i=e[0].legacySetup&&e[0].legacySetup(s,()=>i(r),n),o=()=>{window.removeEventListener("focus",o),n.remove()};n.addEventListener("click",()=>{window.addEventListener("focus",o)}),n.addEventListener("change",()=>{window.removeEventListener("focus",o),n.remove(),s(n.multiple?Array.from(n.files):n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),ee={__proto__:null,default:J},te=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,r)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const a=i=>{typeof s=="function"&&s(),t(i)},s=e[0].legacySetup&&e[0].legacySetup(a,()=>s(r),n);n.addEventListener("change",()=>{let i=Array.from(n.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(i=i.filter(o=>o.webkitRelativePath.split("/").every(c=>!e[0].skipDirectory({name:c,kind:"directory"})))):i=i.filter(o=>o.webkitRelativePath.split("/").length===2),a(i)}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),re={__proto__:null,default:te},ne=async(e,t={})=>{Array.isArray(t)&&(t=t[0]);const r=document.createElement("a");let n=e;"body"in e&&(n=await async function(i,o){const c=i.getReader(),l=new ReadableStream({start:m=>async function f(){return c.read().then(({done:p,value:h})=>{if(!p)return m.enqueue(h),f();m.close()})}()}),u=new Response(l),d=await u.blob();return c.releaseLock(),new Blob([d],{type:o})}(e.body,e.headers.get("content-type"))),r.download=t.fileName||"Untitled",r.href=URL.createObjectURL(await n);const a=()=>{typeof s=="function"&&s()},s=t.legacySetup&&t.legacySetup(a,()=>s(),r);return r.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(r.href),3e4),a()}),r.click(),null},ae={__proto__:null,default:ne};const se=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],ie=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],oe=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],ce=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],x=(e,t,r)=>{let n=e;return typeof t=="string"||Array.isArray(t)?n=e.toLocaleString(t,r):(t===!0||r!==void 0)&&(n=e.toLocaleString(void 0,r)),n};function _(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const r=t.bits?t.binary?ce:oe:t.binary?ie:se,n=t.space?" ":"";if(t.signed&&e===0)return` 0${n}${r[0]}`;const a=e<0,s=a?"-":t.signed?"+":"";a&&(e=-e);let i;if(t.minimumFractionDigits!==void 0&&(i={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(i={maximumFractionDigits:t.maximumFractionDigits,...i}),e<1){const u=x(e,t.locale,i);return s+u+n+r[0]}const o=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),r.length-1);e/=(t.binary?1024:1e3)**o,i||(e=e.toPrecision(3));const c=x(Number(e),t.locale,i),l=r[o];return s+c+n+l}const le=document.querySelector("#load-wasm"),de=document.querySelector("#load-directory");document.querySelector("#before-size");document.querySelector("#after-size");document.querySelector("#delta-size");const b=document.querySelector("#drop-area"),P=document.querySelector("#results-area"),ue=document.querySelector("#stats-template"),me=document.querySelector("#example-template"),fe=document.querySelector("#stats-header"),w=document.querySelector("#overwrite-checkbox"),v=document.querySelector("#observe-changes-checkbox"),N=document.querySelector("#examples-list");async function pe(e,t){const r=[];async function n(s){for(const[i,o]of s)try{r[i]=await o()}catch(c){r[i]=new Error(`Failed with: ${c.message}`)}}const a=new Array(t).fill(e.entries()).map(n);return await Promise.allSettled(a),r}const he=["https://unpkg.com/canvaskit-wasm@0.39.1/bin/canvaskit.wasm","https://unpkg.com/zxing-wasm@1.0.0-rc.4/dist/full/zxing_full.wasm","https://unpkg.com/@sqlite.org/sqlite-wasm@3.44.0-build1/sqlite-wasm/jswasm/sqlite3.wasm","https://unpkg.com/@tensorflow/tfjs-backend-wasm@4.13.0/wasm-out/tfjs-backend-wasm.wasm"],ye=/@(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?/,A="getAsFileSystemHandle"in DataTransferItem.prototype,we="FileSystemObserver"in window,E=new Map;let g=null;const ge=e=>{console.log(e)},z=()=>(g||(g=new FileSystemObserver(ge)),g);(()=>{const e=r=>{const n=document.querySelector("meta[name=theme-color]");if(r.matches){n.content="Canvas";return}};matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e),e(matchMedia("(prefers-color-scheme: dark)")),we&&(v.parentNode.hidden=!1,v.addEventListener("change",()=>{if(localStorage.setItem("observe-changes",v.checked),v.checked){z();for(const[,r]of E.entries())r.handle&&(console.log(`Observing ${r.name} for changes.`),g.observe(r.handle));return}g&&(g.disconnect(),g=null)}),localStorage.getItem("observe-changes")!=="true"?v.checked=!1:v.checked=!0),A&&y&&(w.parentNode.hidden=!1,w.addEventListener("change",()=>{localStorage.setItem("overwrite",w.checked)}),localStorage.getItem("overwrite")!=="true"?w.checked=!1:w.checked=!0),he.forEach(r=>{const n=me.content.cloneNode(!0),a=n.querySelector("code"),s=n.querySelector("a");a.textContent=r.replace("https://unpkg.com/","").replace(ye,""),s.href=r,N.append(n)}),"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{await navigator.serviceWorker.register("./sharetargetsw.js",{scope:"./share-target/"})}catch(r){console.error(r.name,r.message)}if(location.search.includes("share-target"))try{const n=new URLSearchParams(location.search).get("share-target"),a=await caches.keys(),s=await caches.open(a.filter(l=>l.startsWith("media"))[0]),i=await s.match("shared-wasm-file");await s.delete("shared-wasm-file");const o=await i.blob(),c=new File([o],n,{type:"application/wasm"});c.handle=!1,k([c])}catch(r){console.error(r.name,r.message)}}),D({onOfflineReady(){},onNeedRefresh(){location.reload()}})()})();document.addEventListener("paste",e=>{try{if(!e.clipboardData.files.length)return;const t=Array.from(e.clipboardData.files).filter(r=>r.type==="application/wasm"||r.name.endsWith(".wasm"));k(t)}catch(t){console.error(t.name,t.message)}});N.addEventListener("click",async e=>{if(e.target.nodeName.toLowerCase()!=="code")return;e.preventDefault();const t=e.target.closest("a"),r=t.href,n=t.parentNode.querySelector(".downloading");n.hidden=!1;const a=t.parentNode.querySelector("img");a.src=T;const s=await fetch(r).then(o=>o.blob());a.removeAttribute("src"),n.hidden=!0;const i=new File([s],r.split("/").pop(),{type:"application/wasm"});i.handle=!1,k([i])});P.addEventListener("click",async e=>{if(e.target.nodeName.toLowerCase()!=="code")return;const t=e.target.closest("a");if(!t.classList.contains("file-name")||t.dataset.processing)return;e.preventDefault();const r=t.dataset.uuid,n=E.get(r);try{await Z(n,{fileName:n.name,extensions:[".wasm"],mimeTypes:["application/wasm"]})}catch(a){if(a.name==="AbortError")return;console.error(a.name,a.message)}});de.addEventListener("click",async()=>{try{const t=(await j({recursive:!0,mode:"readwrite"})).filter(r=>r.type==="application/wasm"||r.name.endsWith(".wasm"));k(t)}catch(e){if(e.name==="AbortError")return;console.error(e.name,e.message)}});le.addEventListener("click",async()=>{try{const e=await W({mimeTypes:["application/wasm"],extensions:[".wasm"],multiple:!0});if(!e||!e.length)return;k(e)}catch(e){if(e.name==="AbortError")return;console.error(e.name,e.message)}});b.addEventListener("dragover",e=>{e.preventDefault()});b.addEventListener("dragenter",e=>{b.classList.add("drag-hover")});b.addEventListener("dragleave",e=>{b.classList.remove("drag-hover")});b.addEventListener("drop",async e=>{e.preventDefault(),b.classList.remove("drag-hover");const t=[...e.dataTransfer.items].filter(n=>n.kind==="file").map(n=>A?n.getAsFileSystemHandle():n.getAsFile()),r=[];for await(const n of t){let a=n;n.kind==="file"&&(a=await n.getFile(),a.handle=n),!(a.type&&a.type!=="application/wasm"||!a.name.endsWith(".wasm"))&&r.push(a)}y&&y&&w.checked&&await I(r),k(r)});"launchQueue"in window&&"files"in LaunchParams.prototype&&launchQueue.setConsumer(async e=>{if(!e.files.length)return;const t=[];for(const r of e.files){const n=await r.getFile();n.handle=r,!(n.type&&n.type!=="application/wasm"||!n.name.endsWith(".wasm"))&&t.push(n)}y&&y&&w.checked&&await I(t),k(t)});const I=async e=>{for(const t of e)await t.handle.requestPermission({mode:"readwrite"})},k=async e=>{fe.hidden=!1,P.closest("table").hidden=!1;const t=[];for(const r of e){const n=ue.content.cloneNode(!0),a=n.querySelector(".file-name"),s=n.querySelector(".before-size"),i=n.querySelector(".after-size"),o=n.querySelector(".delta-size"),c=n.querySelector(".spinner");c.src=T,a.querySelector("code").textContent=r.name,a.dataset.processing=!0,s.textContent=_(r.size),P.append(n),t.push(()=>new Promise((l,u)=>{const d=new Worker(new URL("/wasm-clamp/assets/worker-852eb24e.js",self.location));d.addEventListener("message",async m=>{d.terminate(),delete a.dataset.processing;const{wasmFileAfter:f,error:p}=m.data;if(p){u(p),a.classList.add("error"),i.classList.add("error"),o.classList.add("error"),i.textContent=p.name,o.textContent=p.message;return}i.textContent=_(f.size);const h=f.size-r.size;console.log(r.name,"→","Before:",r.size,"After:",f.size,"Delta:",h),o.textContent=h===0?"no change":`${Math.abs(100-f.size/r.size*100).toFixed(2)}% ${h<0?"smaller":"larger"}`,o.classList.add(h<0?"size-smaller":"size-larger");const L=crypto.randomUUID();a.dataset.uuid=L,E.set(L,f),h<0&&A&&y&&w.checked&&r.handle&&(await r.handle.createWritable().then(B=>{B.write(f),B.close()}),E.set(L,r)),v.checked&&(z(),console.log(`Observing ${r.name} for changes.`),g.observe(r.handle)),l()}),d.postMessage({wasmFileBefore:r})}))}await pe(t,"hardwareConcurrency"in navigator?Math.floor(navigator.hardwareConcurrency/2):4)};
